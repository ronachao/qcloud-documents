## 读写分离的模式
读写分离的基本原理是让主节点 (Master) 处理事务性操作，例如：增加（INSERT）、更新（UPDATE）、删除（DELETE）操作，让从节点 (Slave) 处理查询（SELECT）操作，将读写功能分开处理，以降低主节点处理数据的压力。
TDSQL 默认支持读写分离功能，架构中的每个从机都支持只读能力，如果配置有多个从机，将由网关集群自动分配到低负载从机上，以支撑大型应用程序的读取流量。
支持以下4种模式的读写分离操作。
- 创建只读账号：您仅需要在创建帐号时，标记为只读帐号，系统将根据只读策略向将读请求发往从机；只读策略可以根据主从延迟等维度进行灵活配置
- 配置Proxy参数：开启语法解析的配置，通过语法解析过滤出用户选择的读请求，默认把读请求直接发给备机
- slave注释：在编程过程中，通过增加Slave注释模式标记，将指定的SQL指令发往备机。即在SQL中添加/*slave*/标记，该SQL会发送给备机，常用于编程阶段将特殊的读逻辑嵌入代码

>?系统还支持/*slave:slaveonly*/,/*slave:20*/,/*slave:slaveonly,20*/三种形式。数值表示备机（Slave）应该满足的延迟；Slaveonly表示在没有符合条件的备机（Slave）时，不会将查询发送给主节点

- 	全局自动读写分离：该配置会自动将 SQL 中的所有读请求发向从机，且能识别事务、存储过程中的读语法并灵活处理。当然如果从机延迟较大，全局自动读写分离并不具备应对策略，读到的数据可能会有延迟，若使用该功能，性能有大约50%的下降。该功能默认未开启。

>?读写分离由此为应用提高总的读取吞吐量。通过多种只读方案的组合，可以配置出复杂的只读方案，以满足您各种业务需求和开发的灵活性。

- 【建议】推荐采用只读账号或Slave注释的方式实现读写分离
- 【建议】对于主从延迟严格敏感的 select 语句，可以从主库读取
- 【建议】当主库CPU使用率大于60%时，可考虑将部分对数据一致性要求没有那么高的业务开启读写分离

## 读写分离故障的影响
- proxy故障对读写分离的影响：非全部proxy故障无影响
- 	DB节点故障，对读写分离的影响：
   主库故障触发主从切换，影响只读
 	 备库故障，根据只读账号属性不同，直接返回读异常或路由到主节点
- 其他事件、故障 对读写分离的影响：只看结果的话，如果是造成了实例异常(无法访问或延迟超过阈值，同2；否则无影响)
