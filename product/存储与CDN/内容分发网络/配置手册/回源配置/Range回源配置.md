## 配置场景
腾讯云 CDN 在缓存资源时，为提高存储效率会将文件进行切片存储，并且支持 Range 请求，若请求时携带 HTTP 头部`Range: bytes = 0-999`，则返回文件的前1000个字节给用户。

开启分片回源配置，若用户请求的部分文件已过期，CDN 会根据用户请求进行分片回源，仅拉取用户需要的部分文件进行缓存，同时返回给用户；关闭分片回源配置，即便用户请求的是部分文件，CDN 在回源时仍会拉取整个文件，而后进行缓存，并响应给用户其要求的部分文件。

开启分片回源配置能够有效提高大文件分发效率，提升响应速度，降低源站压力。

> ?
> - 开启分片回源配置后，资源在节点上分片缓存，但所有分片的缓存过期时间保持一致，按照用户指定的缓存过期规则。
> - 若您的资源都是静态小文件，或源站为 COS 源站且**已使用**数据处理类功能（例如：图片处理），不建议开启分片回源，开启后会影响回源。
> - 若您的资源都是静态大文件，且源站已支持 Range 请求，或源站为 COS 源站且**未使用**数据处理类功能（例如：图片处理），建议开启分片回源，提升分发效率和响应速度。
> - 开启分片回源配置时，需要确认源站已经支持 Range 请求，否则可能会导致回源失败。

## 配置指南

### 添加域名

添加加速域名时，根据不同的业务类型和源站类型，分片回源默认关闭或开启，您可按需调整，或添加域名后前往此配置项管理配置规则。



### 管理域名
域名添加后，单击域名操作列的**管理**，进入域名配置页面，切换 Tab 至**回源配置**，即可找到**分片回源配置**。
![](https://main.qcloudimg.com/raw/57126fb0be1b941813f9e4661ca549bf.png)

**配置约束**
1. 全部文件规则 - 默认最低优先级，不可调整优先级，不可删除。
2. 支持添加按文件后缀/文件目录/全路径文件配置的规则，最多可添加20条规则，可调整优先级。


## 配置示例
若域名`cloud.tencent.com`的分片回源配置如下：
![](https://main.qcloudimg.com/raw/724500ca5aa62e924bd96e1251945ecb.png)
用户 A 请求资源：`http://cloud.tencent.com/test.apk`，节点收到请求后，发现缓存的`test.apk`文件已过期，此时发起回源请求，节点回源使用 Range 请求，分片获取资源并缓存。若此时用户 B 发起的也为 Range 请求，当节点上存储的分片已满足 Range 中指定的字节段，则会直接返回给用户，无需等所有分片获取完毕。

