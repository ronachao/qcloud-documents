## 操作场景

本文主要介绍如何创建、编辑容器实例、查看事件及日志等。根据不同的使用场景，提供了两种创建方式。快速简单上手请参见 [快速创建容器实例](#EKSCI1)，如需使用多容器组等高阶能力，请参见 [创建容器实例](#EKSCI2)。两种模式支持的配置如下：

| 支持项                                 | 快速创建 | 完整创建 |
| -------------------------------------- | -------- | -------- |
| 全部地域                               |   &#10003;       |      &#10003;    |
| 全部规格                               |   &#10003;       |   &#10003;      |
| 数据卷                                 |       &#10003;   |   &#10003;       |
| 容器环境变量                           |   &#10003;       |       &#10003;   |
| 实例数量                               |     &#10003;     |   &#10003;       |
| 多容器                                 |     ×    |      &#10003;    |
| 容器高级配置（运行命令、初始化容器等） |    ×      |      &#10003;    |
| 重启策略（默认 Always）                |     ×     |    &#10003;      |
| 日志采集                               |     ×     |     &#10003;     |
| 绑定角色                               |     ×    |    &#10003;     |
| 绑定弹性公网 IP                        |       ×   |    &#10003;      |

>?在快速创建中不支持的能力，后续可通过编辑操作更新，更新过程中內网 IP 不变。





## 操作步骤


### 首次授权

当首次使用容器实例 EKSCI 时，为了能够使用相关云资源，会授予您的账户 TKE_QCSRole 服务角色的权限，该角色对应的预设策略请参见 [服务授权相关角色权限说明](https://cloud.tencent.com/document/product/457/43416#tke_qcsrole-.E8.A7.92.E8.89.B2.3Ca-id.3D.22tke_qcsrole.22.3E.3C.2Fa.3E)。授权步骤如下：

1. 登录 [容器实例控制台]()，若此时未完成角色授权，将弹出【服务授权】窗口。
2. 单击【前往访问管理】，进入角色管理页面。
3. 单击【同意授权】，完成身份验证后即可成功授权。如下图所示：
   ![](https://main.qcloudimg.com/raw/8629243eb446ee89230c8c20ed702cee.png)

>?若您之前使用过容器服务 TKE、弹性容器服务 EKS 集群，可能已完成该角色的授权，则不会触发以上授权，可单击 [访问管理控制台](https://console.cloud.tencent.com/cam/role) 查看是否存在 TKE_QCSRole 角色。

[](id:EKSCI1)

### 快速创建容器实例

为方便您快速创建容器实例，容器实例 EKSCI 看着他提供快速创建入口，操作步骤如下：

1. 登录 [容器实例控制台]()，进入弹性容器实例页面。
2. 单击【快速创建】，如下图所示：
![](https://main.qcloudimg.com/raw/411333520ba81152812e06dc7027ea6f.png)
2. 选择地域、网络及安全组。
	- 网络包括私有网络 VPC 及子网；
	- 安全组，可限制容器实例的网络通信，默认为 default。
>!子网决定了可用区，每个可用区所支持的资源类型不同，例如 AMD、GPU-T4、GPU-V100，请根据提示选择支持所需资源类型的子网。
3. 选择容器实例规格。支持的规格请参见 [资源规格](https://cloud.tencent.com/document/product/457/39808)。
4. 选择镜像及镜像访问凭证。支持选择容器镜像服务 TCR、CCR、Dockerhub 及其他第三方镜像仓库的镜像。
<dx-alert infotype="notice" title="">
当选择容器镜像服务 TCR、CCR 的私有镜像及除 Dockerhub 以外的第三方镜像时，必须填写镜像凭证，即仓库的访问地址及密码（长期凭证）。
</dx-alert>

	高级配置中支持：
	- 数据卷。为容器提供存储，目前支持文件存储 NFS、腾讯云硬盘 CBS，还需挂载到容器的指定路径中。如下：
	<table>
   <tr>
      <th>数据卷类型</th>
      <th>描述</th>
   </tr>
   <tr>
      <td>云硬盘 CBS</td>
      <td>您可以指定一块腾讯云的 CBS 云硬盘挂载到容器的某一路径下，当容器迁移时，云硬盘会随之迁移。使用云硬盘数据卷适用于数据的持久化保存，可用于 Mysql 等有状态服务。设置云硬盘数据卷的服务，实例数量最大为1。</td>
   </tr>
   <tr>
      <td>文件存储 NFS</td>
      <td>只需填写 NFS 路径，您可以使用腾讯云文件存储 CFS，也可使用自建的文件存储 NFS。使用 NFS 数据卷适用于多读多写的持久化存储，也适用于大数据分析、媒体处理、内容管理等场景。</td>
   </tr>
</table>
	- 环境变量，支持配置容器的环境变量。详情请参见 [环境变量]()。
	- 实例数量。支持一次创建多个实例。当数据卷类型选择云硬盘 CBS 时，只能创建一个副本。
5. 完成所需配置项后，确认资源规格及配置费用，单击创建实例。可查看实例的事件查看创建进度及流程。





[](id:EKSCI2)

### 创建容器实例

若想使用多容器、日志采集等能力，可选择完整的创建实例流程。
1. 登录 [容器实例控制台]()，进入弹性容器实例页面。
2. 单击【新建实例】，如下图所示：
![](https://main.qcloudimg.com/raw/4e76f7ed424a9e8ca35af5d77f295fe5.png)
3. 根据实际需求，设置容器实例的参数。关键信息如下：
	- **容器实例名称**：自定义。
	- **所属地域**：根据实际环境进行选择。
	- **网络**：包括私有网络 VPC 及子网。子网决定了可用区，每个可用区所支持的资源类型不同，例如 AMD、GPU-T4、GPU-V100，请根据提示选择支持所需资源类型的子网。
	- **安全组**：可限制容器实例的网络通信，默认为 default。
	- **实例规格**：支持的规格请参见 [资源规格](https://cloud.tencent.com/document/product/457/39808)。
	- **数据卷**：为容器提供存储，目前支持文件存储 NFS、腾讯云硬盘 CBS，还需挂载到容器的指定路径中。
	- **容器内配置**（支持添加多个容器）：
		- **名称**：自定义。
		- **镜像**：支持选择容器镜像服务 TCR、CCR、Dockerhub 及其他第三方镜像仓库的镜像。
		- **镜像访问凭证**：当选择容器镜像服务 TCR、CCR 的私有镜像及除 Dockerhub 以外的第三方镜像时，必须填写镜像凭证，即仓库的访问地址及密码（长期凭证）。
		- **高级设置**： 
			- **CPU 限制**：默认为空，此时该 container 默认可使用全部的实例资源，支持设置该容器最多可使用多少 CPU 资源。
			- **内存限制**：默认为空，此时该 container 默认可使用全部的实例资源，支持设置该容器最多可使用多少内存资源。
			- **健康检查**：详情请参见 [容器健康检查](https://cloud.tencent.com/document/product/457/32815)。
			- **运行命令及参数**：详情请参见 [容器的运行命令和参数](https://cloud.tencent.com/document/product/457/32816)。
			- **初始化容器**：支持将此容器设置为 init container，注意除i nit container 之外必须有一个业务容器。
	- **实例数量**，支持一次性创建多个实例。
4. 完成以上所需配置后：
[](id:log)
 - 若还需设置以下高阶配置，可单击【下一步】，并进行相应的配置：
<dx-tabs>
::: 重启策略
支持更换重启策略，主要有以下三种，默认是 Always。
- **Always**：只要容器不是运行中的状态时，自动重启该容器。
- **Never**：无论状态为何，从不重启该容器。
- **OnFailure**：容器终止运行且退出码不为0时，自动重启该容器。
重启策略（restart policy）实际上是作用于实例內容器的行为，并不代表容器实例会被重启。
:::
::: 日志采集
支持开启日志采集功能。开启日志采集后，需要进行以下配置：
1. 选择日志集和日志主题，若无合适的，请参见 [新建日志集及日志主题](https://cloud.tencent.com/document/product/614/34340#3.-.E5.88.9B.E5.BB.BA.E6.97.A5.E5.BF.97.E9.9B.86.E5.92.8C.E6.97.A5.E5.BF.97.E4.B8.BB.E9.A2.98)。
2. 配置采集路径，支持标准输出 stdout 和绝对路径，支持 `*` 通配，多个采集路径以 `,` 分隔。
3. 开启日志采集必须为实例绑定一个以 CVM为 载体，具备“cls:pushLog”权限的角色。具体操作请见角色授权。
>? 在 [日志服务控制台](https://console.cloud.tencent.com/cls/search?region=ap-guangzhou&logset_id=a3b4ebb0-05b3-4903-9fa8-e173ff60d6aa&topic_id=026d3206-7edc-4c45-adf6-31046db3866b) 检索日志时，需要打开日志主题的【日志索引】。索引配置是使用日志服务 CLS 进行检索分析的必要条件。若未开启，则无法查看日志。配置索引的详细操作，请参见 [日志服务配置索引](https://cloud.tencent.com/document/product/457/47200)。
>:::
::: 角色授权
支持给实例绑定一个角色授权。若无合适的角色，创建过程参考以下步骤：
**新建策略**
1. 登录访问管理控制台，在左侧导航栏选择【[策略](https://console.cloud.tencent.com/cam/policy)】。
2. 在“策略”页面，单击【新建自定义策略】。
3. 在“选择创建策略方式” 弹窗中，选择【按策略生成器创建】。
4. 选择所需要授权给实例的权限，这个以开启日志采集为例，选择“cls:pushLog”读操作，单击【下一步】。
5. 确认策略名称，单击【完成】。

**新建角色**
1. 登录访问管理控制台，在左侧导航栏选择【[角色](https://console.cloud.tencent.com/cam/role)】。
2. 在“角色”页面，单击【新建角色】。
3. 在“选择角色载体” 弹窗中，选择【腾讯云产品服务】，进入【新建自定义角色】页面。
4. 在“输入角色载体信息”步骤中，选择**绑定【云服务器（cvm）】载体**，单击【下一步】。
  <dx-alert infotype="notice" title="">
必须选择【云服务器（cvm）】作为角色载体，选择容器服务则无法完成授权。
  </dx-alert>
5. 在“配置角色策略”步骤中，选择上一步中新建的策略，并单击【下一步】。
6. 在“审阅”步骤中，输入您的角色名称，审阅您即将创建角色的相关信息，单击【完成】后即完成自定义角色创建。详情请参见 [创建角色](https://cloud.tencent.com/document/product/598/19381)。
:::
::: 弹性公网\sIP
支持为实例绑定弹性公网 IP，实现与公网互通。支持两种绑定方式：
- **自动创建**：需要定义带宽峰值，默认创建按量计费的弹性公网 IP，可在 [弹性公网控制台](https://console.cloud.tencent.com/cvm/eip?rid=1) 查看。如需选择共享包等预付费模式，请选择已有弹性公网 IP。
>?自动创建的弹性公网 IP 的生命周期与容器实例保持一致，删除容器实例后，弹性公网 IP 会随之删除。
- **选择已有的弹性公网 IP**：选择的弹性 IP 的数量需要和实例数量保持一致。
>! 只有带宽上移用户可使用该能力。
:::
</dx-tabs>
 - 若无需以上配置，可直接单击【完成】，进行配置确认。
4. 确认配置都符合需求，单击【完成】创建。






### 编辑容器实例



1. 登录 [容器实例控制台]()，在需要编辑的实例右侧，单击【编辑】。
2. 修改完成参数后，单击【完成】。
>?容器实例的以下配置不支持修改，若需要修改，请重新创建。
	- 地域
	- 网络
	- 安全组
	- 资源规格
