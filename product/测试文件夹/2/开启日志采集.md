## 操作场景

弹性容器实例 EKSCI 提供日志采集能力，支持将集群内容器标准输出日志、容器日志文件日志发送至 [日志服务 CLS](https://cloud.tencent.com/product/cls)，适用于需要对 EKSCI 内服务日志进行存储和分析的用户。

## 前提条件

- 准备一个 CLS 的日志主题作为日志上报终端，日志上报后在该日志主题下查看并检索日志。若无合适的日志主题，请参见 [新建日志集及日志主题](https://cloud.tencent.com/document/product/614/34340#3.-.E5.88.9B.E5.BB.BA.E6.97.A5.E5.BF.97.E9.9B.86.E5.92.8C.E6.97.A5.E5.BF.97.E4.B8.BB.E9.A2.98)。
- **打开日志主题的【日志索引】**。索引配置是使用日志服务 CLS 进行检索分析的必要条件。若未开启，则无法查看和检索日志。配置索引的详细操作，请参见 [日志服务配置索引](https://cloud.tencent.com/document/product/614/50922)。 
  您可在【[日志服务控制台](https://console.cloud.tencent.com/cls/topic?region=ap-guangzhou)】>【日志主题】中，选择日志主题名称，在“索引配置”页面开启索引。如下图所示： ![](https://main.qcloudimg.com/raw/ad0ec6edc772202eaa9305100347a09b.png)

## 操作步骤

### 创建容器实例

>?日志采集需要在创建容器实例时开启。

1. 登录 [容器实例控制台]()，单击新建实例。如下图所示：
![](https://main.qcloudimg.com/raw/77acbe024b79bd88832fab3eaeb7fec5.png)
2. 根据实际需求，设置容器实例的参数，具体请参见 [创建容器实例](https://cloud-doc.isd.com/document/product/457/57341#step2)。完成后，单击下一步。
3. 开启日志采集后，选择以下参数：
	- 选择日志集及日志主题。
	- 选择容器，配置采集路径，支持“stdout”（表示标准输出）和绝对路径，支持 `*` 通配，多个采集路径以 `,` 分割。
		![](https://main.qcloudimg.com/raw/b0a972651e70657555057da1f870e8e9.png)
4. 绑定角色。由于上传日志到 CLS 需要上传日志的权限，因此开启日志采集需要绑定一个角色授予实例相应的权限。
![](https://main.qcloudimg.com/raw/aa5a017288262c551d6672a8241093fa.png)
若无合适的角色，请单击【新建CAM角色】。具体步骤如下：

#### 新建策略

在新建角色之前，您需要创建一个策略，该策略决定了您的角色具备哪些权限。
1. 登录访问管理控制台，在左侧导航栏选择【[策略](https://console.cloud.tencent.com/cam/policy)】。
2. 在“策略”页面，单击【新建自定义策略】。
3. 在“选择创建策略方式” 弹窗中，选择**【按策略生成器创建】**。
4. 选择所需要授权给实例的权限，这个以开启日志采集为例，选择“cls:pushLog”读操作，单击【下一步】。
5. 确认策略名称，单击【完成】。


#### 新建角色

创建策略完成后，需要将该策略绑定至一个角色，使得该角色具备策略相应的权限。一个角色可以绑定多个策略，您可根据需求配置多个策略绑定到一个角色，并随时解绑。

1. 登录访问管理控制台，在左侧导航栏选择【[角色](https://console.cloud.tencent.com/cam/role)】。
2. 在“角色”页面，单击【新建角色】。
3. 在“选择角色载体” 弹窗中，选择【腾讯云产品服务】，进入【新建自定义角色】页面。
4. 在“输入角色载体信息”步骤中，选择**绑定【云服务器（cvm）】载体**，单击【下一步】。
5. 在“配置角色策略”步骤中，选择上一步中新建的策略名称，单击【下一步】。
6. 在“审阅”步骤中，输入您的角色名称，审阅您即将创建角色的相关信息，单击【完成】后即完成自定义角色创建。详情请参见 [创建角色](https://cloud.tencent.com/document/product/598/19381)。
> !必须选择**【云服务器（cvm）】作为角色载体**，选择其他载体则无法完成授权。
7. 选择好角色后，单击配置确认，完成实例创建，同时为该实例开启了日志采集。


### 查看采集的日志

1. 登录 [日志服务控制台](https://console.cloud.tencent.com/cls/overview?region=ap-guangzhou)，选择左侧【检索分析】。
2. 进入“检索分析”页面，选择地域、需要查看日志的日志集和日志主题，开启全文索引，即可检索分析日志。如下图所示：
![](https://main.qcloudimg.com/raw/389f8fcc174e7ffc651b8f488b3691fc.png)

## 常见问题

#### 未查看到日志该如何处理？

若已确定有日志上报，但是未查看到日志，请检查以下问题：
1. 检查绑定的角色是否有上报日志的权限，具体配置请看上文。
2. 检查绑定的角色所选的载体是否是 CVM。

如果您的问题仍未解决，请 [提交工单](https://console.cloud.tencent.com/workorder/category?level1_id=6&level2_id=350&source=0&data_title=%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1TKE&step=1) 联系我们。
