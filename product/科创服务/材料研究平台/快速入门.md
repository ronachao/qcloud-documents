本文档提供简单的操作指引，方便用户快速了解和使用材料研究平台 MRP。

## 服务授权和创建项目
### 步骤1：服务授权
在您开通并登录腾讯云账号后，进入 [MRP 控制台](https://console.cloud.tencent.com/mrp)，在弹出的页面中开通服务授权。
1. 单击弹窗中的**前往授权**，页面将跳转至访问管理控制台。
2. 单击**同意授权**，即可创建服务预设角色并授予材料模拟平台相关权限。
3. 完成授权后，切换回原标签页，单击**已完成授权**，即可执行后续步骤。

### 步骤2：创建项目
完成服务授权后，您可在 MRP 中创建一个项目。
在 MRP 中，项目是一个基础的管理单元，承载着对人员、实验、消耗资源进行管理的功能。用户需在项目中进行实验提交、数据处理等操作。
>!创建项目和添加项目成员操作需要主账号权限。

**创建项目流程如下：**
1. 进入 [MRP 控制台](https://console.cloud.tencent.com/mrp)，默认显示项目列表页面，单击页面左上角**创建项目**。
![](https://qcloudimg.tencent-cloud.cn/raw/226f4183704b71a64e108109c01c4bfe.png)
2. 填写项目名称，并且选择是否开通 [Cloud Shell](#cloud) 服务。
 - 若选择开通 Cloud Shell 服务，用户需选择功能依赖的 [容器服务](https://cloud.tencent.com/document/product/457) 相关参数。
 - 若不选择开通 Cloud Shell 服务，后续也可在 MRP 项目列表开通该服务。
3. 完成项目创建。

### 步骤3：子账号授权
>?子账号授权为添加项目成员的前置步骤，若用户不需要拉取其他账号作为项目成员，则可忽略该步骤。

子账号首次登录时，主账号需要为子账号授予 AAAAAA 权限。添加权限的方式如下：
1. 登录腾讯云 [账号信息](https://console.cloud.tencent.com/developer) 页面创建子账号，详情请参考 [创建子账号并授权](https://cloud.tencent.com/document/product/598/54458)。
2. 在策略列表中搜索 AAAAA 策略，选择相应的策略名称后单击**确定**。
>?对于已有的子账号，主账号可以在 [用户列表](https://console.cloud.tencent.com/cam) 页面中找到此账号，并单击**授权**进行权限修改。

### 步骤4：添加项目成员
创建项目完成后，添加项目成员的步骤如下：
1.	具有 AAAAAA 权限的子账号用户可单击 MRP 控制台项目列表中的**申请加入**申请加入项目。子账号用户需填写申请信息。
2.	子账号申请后，主账号用户单击**新增成员**，弹出申请列表弹窗。主账号可在弹窗中对申请账号进行**通过**和**拒绝**判断。
3.	项目成员添加完成后，用户单击**查看成员**即可查看项目内成员列表。

## [实验计算](id:calculate)
MRP 为用户提供操作简便的可视化操作页面，为材料研究人员提供从实验计算到数据处理的全流程支持。在您使用之前，您需要先创建或加入一个项目。


### 步骤1：创建实验
1. 进入 [MRP 控制台](https://console.cloud.tencent.com/mrp)，单击左侧导航栏中的**实验列表**，页面将跳转至实验列表页面。此列表包括用户通过可视化页面和 cloud shell 创建的所有实验。
2. 在实验列表页面中，单击左上角**创建实验**，弹出实验参数填写弹窗。实验参数包括以下内容：
 - 计算软件：必填项，可选择 VASP 和 LAMMPS。
 - 实验名称：必填项，设置要创建的实验名字。
 - 备注：选填项，用户可在此处记录实验特征、内容、计算目标等备注信息。
 - 父实验：选填项，父子实验是 MRP 设计用来管理实验之间逻辑关系的方法。用户若选择某一实验为当前所创建实验的父实验，则在实验列表中会展示实验之间的逻辑关系，如下图所示。
![](https://qcloudimg.tencent-cloud.cn/raw/0692336bb1e04c859702f0f73454c213.png) 

### 步骤2：编辑实验
实验创建完成后，页面跳转至实验编辑页面。

#### VASP 实验
- 针对 VASP 实验，MRP 平台提供两种实验编辑的方法：上传计算文件、手动编辑计算文件。
- 支持的计算文件包括：
 - 必要文件：INCAR、POSCAR、POTCAR 、 KPOINTS
 - 非必要文件： CHGCAR、OPTCELL、WAVACAR、 vdw_kernel.bindat 
- 对于手动编辑计算文件的用户，MRP 提供多种计算文件的模版供用户使用。用户可单击复制模版，并且在粘贴在编辑框中。
![](https://qcloudimg.tencent-cloud.cn/raw/d85a873472f7e60c20f8d642a57b6275.png)

#### LAMMPS 实验
- 针对 LAMMPS 实验，MRP 平台同样提供两种实验编辑的方法：上传计算文件、手动编辑计算文件。
- 支持的计算文件类型包括：in 文件、势文件、结构文件。
 - in 文件：用户可选择上传或者使用页面右侧提供的模版。用户在页面右侧选择合适的模版，单击**使用此模版**，系统会自动在左侧编辑框中添加一个名称为 in，内容为模版内容的文件。用户可在编辑框中对该文件进行编辑。
![](https://qcloudimg.tencent-cloud.cn/raw/f42a752e4810b36075f130f57f92875b.png)
 - 势文件和结构文件：仅支持用户以上传的形式添加。


### 步骤3：运行实验
实验编辑完成后，单击页面左下角**运行实验**，弹出运行参数填写弹窗。针对 VASP 和 LAMMPS 两种软件，运行的参数有所不同，以下会分别说明。

MRP 平台在实验计算的过程中会调用 [云服务器（CVM）](https://cloud.tencent.com/document/product/213)，用户需要根据实验情况选择云服务器参数。云服务器参数包括以下字段：

| **字段**| **内容** | 
|---------|---------|
| 计费类型 | 云服务器的购买参数，包括 [按量计费](https://cloud.tencent.com/document/product/213/2180) 和 [竞价实例](https://cloud.tencent.com/document/product/213/2180) 两种。 | 
| 机器配置 | 选择云服务器的机型和配置。目前 MRP 支持的服务期机型包括：标准型 SA2、标准型 SA3、标准型 S5、内存型 M5、GPU 计算型 GN10Xp。根据用户选择的服务器配置和计费类型，弹窗中会展示出相应的配置单价。 | 
| 并行机器数目| 计算调用的云服务器数目。MRP 平台建议用户优先选择并行机器数目为1。 | 

除了云服务器参数外，用户需根据实验状况选择计算参数和计算镜像。包括以下字段：

<table>
<thead>
<tr>
<th><strong>运行实验</strong></th>
<th><strong>字段</strong></th>
<th><strong>内容</strong></th>
</tr>
</thead>
<tbody><tr>
<td rowspan=2><strong> VASP</td>
<td>CPU 计算核数</td>
<td>当用户选择 CPU 型腾讯云服务器进行计算时，可以自主定义计算过程中调用的机器 CPU 核数，该核数小于等于机器的最大核数。若选择 GPU 型腾讯云服务器进行计算，实际计算过程中，调用机器的 CPU 核数始终等于该 GPU 服务器上V100的卡数。</td>
</tr>
<tr>
<td>VASP 版本</td>
<td>MRP 平台支持多个版本的 VASP 镜像，用户根据自身的计算要求选择合适的 VASP 版本。</td>
</tr>
<tr>
<td rowspan=2 ><strong> LAMMPS</td>
<td>CPU 计算核数</td>
<td>当用户选择腾讯云服务器进行计算时，可以自主定义计算过程中调用的机器 CPU 核数，该核数小于等于机器的最大核数。</td>
</tr>
<tr>

<td>in 文件</td>
<td>用户需根据编辑的实验内容，选择 LAMMPS 实验中运行所需的 in 文件。</td>
</tr>
</tbody></table>

![](https://qcloudimg.tencent-cloud.cn/raw/ce7cd23fe56eb61272c161470dc68613.png)
![](https://qcloudimg.tencent-cloud.cn/raw/fddb91880a43edb4fc50358e54bcdea4.png)

### 步骤4：运行完成
1. 用户选择完运行参数后，单击**运行**，MRP 将会把实验提交到云服务器中进行计算。
2. 实验提交后，用户可在 [实验列表页](https://console.cloud.tencent.com/mrp) 中查看实验状态，单击“实验名称”可查看实验计算详情。
3. 实验计算完成后，用户可查看并处理实验计算数据。详情请参考 [数据处理](#handle)。

## [Cloud Shell](id:cloud)
为了满足 Linux 用户的使用需求、编写和运行 Shell/Python 脚本、更自由地处理数据以及使用开源工具，MRP 支持 Cloud Shell 功能。在您使用之前，您需要先创建或加入一个项目，且该项目已开通 Shell 功能。

### 步骤1：编辑实验
1. 进入 [MRP 控制台](https://console.cloud.tencent.com/mrp)，单击左侧导航栏中的 **Cloud Shell**，页面底部将会弹出 Cloud Shell 操作区域。用户可在操作区域内编辑操作指令。Cloud Shell 中的基本操作指令与 Linux 相同，例如：展开目录‘ls’、创建文件夹‘mkdir’、文件夹跳转‘cd’等。
2. 在 Cloud Shell 中：
 - 当某目录下存在 INCAR、POSCAR、POTCAR 和 KPOINTS 文件，则该目录可被认为是一个 VASP 计算实验。
 - 当某文件夹中文件总数不超过10个，单个文件的大小不超过100M可被认为是一个 LAMMPS 实验。
3. Shell 支持上传文件功能，输入上传命令 ‘rz’ ，页面中弹出上传弹窗，用户将需要上传的文件拖入弹窗中，单击**确定**即可上传。同时用户上传的文件支持利用 vim 工具进行编辑。

### 步骤2：提交实验
1. 获取服务器机型信息 mrp cvm：输入命令后，页面将展示 MRP 平台当前可以调用的云服务器相关信息。信息内容包括：机型、CPU 和 GPU数目、内存、付费模式。其中 POSTPAID_BY_HOUR 和 SPOTPAID 分别表示按量付费和竞价实例，单位均为元/小时；--表示当前的计费模式下没有可调用的对应机型。
2. 提交实验 mrp submit：执行提交命令后，当前目录下的文件会被上传到用户的 [对象存储（COS）](https://cloud.tencent.com/document/product/213/4961) 和 [云服务器（CVM）](https://cloud.tencent.com/document/product/213) 中，提交的实验会在实验列表中显示。

**mrp submit 命令参数**

|  参数    | 是否可选                         | 参数释义                                                     |
| ---- | -------------------------------- | ------------------------------------------------------------ |
| -n   | 可选                  | 指定腾讯云服务器 CVM 的数量，默认值为1。                                    |
| -d   | 必填                             | device 的缩写，指定腾讯云服务器 CVM 的机型。                      |
| -c   | 可选 | 指定计费模式，当前包括竞价实例（SPOTPAID）和按量计费（POSTPAID_BY_HOUR）两种取值，默认值为  POSTPAID_BY_HOUR。 |
| -t   | 可选         | type 的缩写，指定计算软件的类型，包括 vasp_std、vasp_gam、vasp_ncl 和 lammps 四种可选类型，默认值为 vasp_std |
| -ppn | 可选  | 指定计算时每台腾讯云服务器 CVM 使用的核数，默认值为当前机器的总核数。对 GPU 版本的 VASP 计算，-ppn 的值始终等于 GPU 机型的卡数，不需要额外指定。  |
| -in  | 可选                             | 提交 lammps 实验时使用，用于指定 lammps 计算时的 in 文件。（为了保证实验的准确性，建议用户填写）。 |

**实验示例**
为了用户更好地理解提交实验指令，以下给出提交 VASP 和 LAMMPS 实验的示例：
- **VASP 提交示例**：
 - 示例：mrp submit -n 2 -d SA2.8XLARGE64 -c SPOTPAID -t vasp_std -ppn 16
 - 释义：调用2台竞价实例的 SA2.8XLARGE64 的机器做 VASP 计算，每台机器使用的总核数为16，vasp 版本为 vasp_std。
- **LAMMPS 提交示例**：
 - 示例：mrp submit -n 1 -d SA2.8XLARGE64 -c SPOTPAID -t lammps -ppn 4 -in in.melt
 - 释义：调用1台竞价实例的 SA2.8XLARGE64 的机器做 LAMMPS 计算，每台机器使用的总核数为4，in 文件为 in.melt。

### 步骤3：提交完成
1. 用户编辑完成 mrp submit 命令，单击回车即可提交实验。
2. 实验提交后，用户可在控制台 [实验列表](https://console.cloud.tencent.com/mrp) 页中查看实验状态，单击“实验名称”可查看实验计算详情。
3. 实验计算完成后，用户可查看并处理实验计算数据。详情请参考 [数据处理](#handle)。


## [数据处理](id:handle)
MRP 为用户提供自动化的实验数据处理服务，用户可根据自身的需求编辑图片参数，最终导出图片。在使用数据处理功能前，用户在 MRP 系统中成功运行至少一个实验或上传一个有效结果数据。


### 步骤1：数据准备
MRP 平台支持两种产生数据的方法。
- 通过实验计算：用户成功运行实验后获得结果数据。详情请参考 [实验计算](#calculate)、[Cloud Shell](#cloud)。用户可在 MRP 控制台实验列表页中查看所有实验，单击已完成的实验名称，页面跳转至数据处理页面。
- 导入实验结果：用户在 MRP 控制台 [实验列表](https://console.cloud.tencent.com/mrp) 页中，单击页面左上角**导入实验**，弹出上传结果弹窗。目前 MRP 仅支持 VASP 实验结果导入。用户上传有效的 .xml 文件后，页面跳转至数据处理页面。

### 步骤2：数据处理
由于 VASP 和 LAMMPS 两个软件返回的结果不同，所以对其处理方式也不同，以下将分别介绍。

#### VASP
- 目前 MRP 支持六类结果图片处理：晶体结构图、能量收敛曲线、能带结构、态密度、能带-态密度、能带投影。用户可利用数据处理页面右上角的标签切换图片。
- 页面左侧为图片效果展示区域，右侧为参数调整区域。针对不同的图片，MRP 提供不同的参数编辑方式。
- 若不满意目前的图片参数，可单击参数编辑区域右上角**重置**所有参数（包括重置已上传的数据）。

| **图式名称**       | **参数编辑方式**                                               |
| -------------- | ------------------------------------------------------------ |
| 晶体结构图     | 展示视角切换；调整超胞大小。                                   |
| 能量收敛曲线图 | 图片宽高；图中文字字体字号、XY 轴名称和刻度；图示线宽和平滑度。 |
| 能带结构图     | 选择轨道；上传相关 KPOINTS 文件作为 X 轴刻度；图片宽高；图中文字字体字号、XY 轴名称和刻度；图示线宽和平滑度；图例位置。 |
| 态密度图       | 选择轨道；图片宽高；图中文字字体字号、XY 名称和刻度；图示线宽和平滑度；图例位置。|
| 能带-态密度图  | 选择轨道；上传能带/态密度数据；图片宽高；图中文字字体字号、XY 名称和刻度；图示线宽和平滑度；图例位置。|
| 能带投影图     | 图片宽高；图中文字字体字号、XY 名称和刻度；图示线宽和平滑度；图例位置。|

![](https://qcloudimg.tencent-cloud.cn/raw/ee22bac731c4d3a30be5b1a07d6cd1fb.png)

#### LAMMPS
- 目前 LAMMPS 实验结果页面呈现计算得到的体系结果。包括两部分内容：晶体结构演化轨迹，体系参数演化曲线图。
- 页面以视频的方式呈现晶体结构演化轨迹。页面右侧展示根据日志文件绘制的多种体系参数演化曲线图，用户可利用图片上方的标签进行切换。
- 目前 LAMMPS 的实验结果图示不支持编辑，仅支持下载。

### 步骤3：图片和数据下载
用户在图片参数编辑完成后，单击图片展示区域右上角的**下载**，选择合适的下载格式，即可下载当前图片。
- 对于 VASP 实验，用户单击数据处理页面左上角**导出文件**，勾选需要的文件，单击**确定**，即可下载包含相关文件的压缩包。
- 对于 LAMMPS 实验，用户单击数据处理页面左上角**导出结果**，即可下载包含所有输入输出数据的压缩包。


